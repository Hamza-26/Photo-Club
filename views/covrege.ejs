<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="covrege.css">
  <link rel="icon" href="./photo-club-icon.ico" type="image/x-icon">

  <title>
    <%= covrg.ceremonyTitle %>
  </title>

</head>

<body>
  <div id="bigdiv">
    <img src="" id="largeImage">
  </div>
  <header>
    <%- include('header') %>
  </header>

  <main>
    
    
    <div class="covregeContaner">
      <h3>
        <%= covrg.ceremonyTitle %>
      </h3>
      <p>
        <%= covrg.details %>
      </p>
      <h1 id="output"></h1>

      <div class="gallery" id="gallery">
        <% files.forEach(function(file) { %>
          <% if(file.folder == covrg.ceremonyTitle) { %>
          <div class="photo">
            <img src="<%= file.url %>" alt="---">
            <span>
              <i class="bi bi-cloud-download downloadIcon"></i>
              <i class="bi bi-eye eyeIcon"></i>
              <i class="bi bi-trash3 deleteIcon" ></i>

            </span>
          </div>
          <% } %>
          <% }); %>
      </div>
    </div>

    <div class="button-add-search">
      <form action="/upload" method="post" enctype="multipart/form-data" style="display: none;">
        <input required id="fileInput" type="file" name="files" multiple class="form-control" style="display: none;">
        <input required type="text" name="folder" placeholder="folder name" class="form-control" value="<%= covrg.ceremonyTitle %>">
      </form>
    
      <button type="button" id="addButton" class="btn btn-outline-primary">Add</button>
      <button type="button" id="searchButton" class="btn btn-outline-secondary">Search</button>
    </div>
    

  </main>

  <script>


// Upload files
document.addEventListener('DOMContentLoaded', function () {
    document.getElementById('addButton').addEventListener('click', function () {
        document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', function (event) {
        var files = event.target.files;
        if (files) {
            var formData = new FormData();
            for (var i = 0; i < files.length; i++) {
                formData.append('files', files[i]);
            }
            formData.append('folder', '<%= covrg.ceremonyTitle %>'); // Set folder name

            // Make an AJAX request to the server
            fetch('/upload', {
                method: 'POST',
                body: formData
            }).then(response => {
                if (response.ok) {
                    console.log('Files uploaded successfully');
                    window.location.reload(); // Reload the page after successful upload
                } else {
                    console.error('Upload failed');
                }
            }).catch(err => console.error('Error:', err));
        }
    });
});



    let largeImage = document.getElementById('largeImage');
    largeImage.display = 'none';
    document.querySelector('#bigdiv').addEventListener('click', function (e) {
      if (e.target.class !== 'eyeIcon' ) {
        largeImage.src = '';
        bigdiv.style.display = 'none';
      }
    });

    function attachDownloadHandlers() {
      var downloadIcons = document.getElementsByClassName('downloadIcon');
      for (var i = 0; i < downloadIcons.length; i++) {
        downloadIcons[i].addEventListener('click', function () {
          var url = this.parentElement.parentElement.children[0].src;
          var link = document.createElement('a');
          link.href = url;
          link.download = url.substr(url.lastIndexOf('/') + 1);
          link.click();
        });
      }
    }

    function attachViewHandlers() {
  var viewIcons = document.getElementsByClassName('eyeIcon');
  for (var i = 0; i < viewIcons.length; i++) {
    viewIcons[i].addEventListener('click', function (e) {
      var url = this.parentElement.parentElement.children[0].src;
      largen(url);
    });
  }
}
    function largen(url){
      bigdiv = document.getElementById('bigdiv')
      bigdiv.style.display = 'flex';
      bigdiv.style.opicity = '0.9';
      bigdiv.style.width = window.innerWidth + 'px';
      bigdiv.style.height = window.innerHeight + 'px';
      bigdiv.style.position = 'fixed';
      largeImage.src = url;
      largeImage.style.zIndex = '100';
      largeImage.style.maxWidth = '80%';
      largeImage.style.maxHeight = '90%';

    } 




    attachDownloadHandlers();
    attachViewHandlers();


  </script>
  
  
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.9.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

</body>

</html>
